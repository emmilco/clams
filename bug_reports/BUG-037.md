# BUG-037: Install script verification timeout due to model loading

## Reported

- **First noticed on commit**: 8b5a8b7
- **Reported by**: orchestrator
- **Reported at**: 2025-12-11
- **Severity**: low

## Reproduction Steps

1. Run ./scripts/install.sh (or ./scripts/install.sh --skip-qdrant if Qdrant already running)
2. Wait for Step 7 "Verifying installation"
3. Observe the verification step

**Expected**: Verification completes successfully within a reasonable time
**Actual**: Verification times out with "Error: Import verification timeout" after ~30 seconds

## Observations

The install script runs this verification via scripts/verify_install.py which uses subprocess with timeout=5 seconds.

The clams.server.main import chain pulls in clams.embedding which imports sentence-transformers and PyTorch. These heavy libraries take 3.2+ seconds to load.

---

## Investigation (filled by Bug Investigator)

### Reproduction Confirmed

- [x] Steps reproduced bug

**Observations during reproduction**:
Running the install script confirms that Step 7 "Verifying installation" triggers a timeout error. The subprocess call to verify imports times out after 5 seconds.

### Initial Hypothesis

The timeout=5 value in scripts/verify_install.py line 36 is insufficient for the heavy imports required by clams.server.main.

### Differential Diagnosis

| # | Hypothesis | If True, Would See | If False, Would See | Evidence | Status |
|---|------------|-------------------|---------------------|----------|--------|
| 1 | Timeout too short | Import completes if timeout extended | Import fails even with longer timeout | Measured: 4.6-6.2s | **Confirmed** |
| 2 | Infinite loop | Never completes | Completes within finite time | Completes with longer timeout | Eliminated |
| 3 | Missing deps | Import error message | Timeout only | No import errors | Eliminated |

### Root Cause (Proven)

**The bug is caused by**: The timeout=5 value in scripts/verify_install.py line 36 is too short. Import takes 4.6-6.2 seconds.

**Evidence**:
- Direct timing shows 4.6-6.2 seconds consistently
- Import succeeds when timeout is increased to 30 seconds

**Why alternatives were eliminated**:
- Hypothesis 2: Import completes within ~6 seconds with sufficient timeout
- Hypothesis 3: No import error messages, only timeout

---

## Fix Plan

### Code Changes

1. **File**: scripts/verify_install.py
   **Line**: 36
   **Change**: timeout=5 to timeout=30

### Regression Test

**Test file**: tests/scripts/test_bug_037_verify_timeout.py

---

## Implementation (filled by Implementer)

- **Implemented by**: W-1765508517-7466
- **Regression test file**: tests/scripts/test_bug_037_verify_timeout.py

---

## Review (filled by Reviewers)

| Review # | Reviewer | Result | Date |
|----------|----------|--------|------|
| 1 | | | |
| 2 | | | |

---

## Resolution

- **Fixed in commit**: [pending]

# BUG-030: GHAP tools should return minimal responses to reduce token usage

## Reported

- **First noticed on commit**: 22902b24ba20f1df332c8504901132ff379cb2e4
- **Reported by**: orchestrator
- **Reported at**: 2025-12-10T03:22:00Z
- **Severity**: medium

## Problem

The GHAP MCP tools (`start_ghap`, `resolve_ghap`) return the full record with all fields on every operation. This wastes tokens, especially during bulk operations.

### Current Behavior

`start_ghap` returns:
```json
{"id": "ghap_xxx", "domain": "debugging", "strategy": "root-cause-analysis", "goal": "...", "hypothesis": "...", "action": "...", "prediction": "...", "created_at": "..."}
```

`resolve_ghap` returns:
```json
{"id": "ghap_xxx", "status": "confirmed", "confidence_tier": "silver", "resolved_at": "..."}
```

### Expected Behavior

Minimal responses that confirm success:

`start_ghap`:
```json
{"ok": true, "id": "ghap_xxx"}
```

`resolve_ghap`:
```json
{"ok": true, "id": "ghap_xxx"}
```

`update_ghap` (already good):
```json
{"success": true, "iteration_count": 2}
```

### Impact

- During bulk GHAP generation (e.g., 100 entries), returning full records wastes ~500+ tokens per entry
- Total waste: ~50,000 tokens for 100 entries
- Agents already know what they sent; echoing it back adds no value

---

## Investigation (filled by Bug Investigator)

### Reproduction Confirmed

- [x] Steps reproduced bug

**Observations during reproduction**:
Observed during bulk GHAP generation - each response contains full record that was just sent.

### Root Cause (Proven)

**The bug is caused by**: Tool handlers returning full model objects instead of minimal acknowledgments

**Evidence**: Response inspection shows all input fields echoed back

---

## Fix Plan

### Code Changes

1. **File**: `src/clams/server/tools/ghap.py`
   **Function**: `start_ghap` handler
   **Change**: Return `{"ok": True, "id": ghap_id}` instead of full record

2. **File**: `src/clams/server/tools/ghap.py`
   **Function**: `resolve_ghap` handler
   **Change**: Return `{"ok": True, "id": ghap_id}` instead of full record

### Regression Test

**Test file**: `tests/server/tools/test_bug_030_regression.py`

**Test should**:
1. Call start_ghap and verify response only contains `ok` and `id`
2. Call resolve_ghap and verify response only contains `ok` and `id`
3. Verify no other fields are present in responses

---

## Implementation (filled by Implementer)

- **Implemented by**: [worker ID]
- **Commit**: [SHA]
- **Regression test file**: [path]

---

## Review (filled by Reviewers)

| Review # | Reviewer | Result | Date |
|----------|----------|--------|------|
| 1 | [worker ID] | [approved/changes_requested] | [date] |
| 2 | [worker ID] | [approved/changes_requested] | [date] |

---

## Resolution

- **Fixed in commit**: [SHA on main]
- **Verified by**: [worker ID]
- **Closed at**: [timestamp]

# Bug Report: BUG-069

## Title
calm init creates incomplete directory structure missing skills/ and journal/

## First Noticed On Commit
4145288 (current HEAD of main)

## Reproduction Steps
1. Remove `~/.calm/` if it exists
2. Run `calm init`
3. Check: `ls ~/.calm/`

## Expected Behavior
All required directories created, matching the full installer:
`~/.calm/{workflows,roles,sessions,skills,journal}/`

## Actual Behavior
`src/calm/cli/init_cmd.py:28-33` only creates: home, workflows, roles, sessions.
Missing: `skills/` and `journal/`.

The full installer (`src/calm/install/templates.py:230-237`) correctly creates all six.

## Reproduction Confirmed

Verified by code inspection. `src/calm/cli/init_cmd.py` lines 28-33 build the
directories list:

```python
directories = [
    home,
    settings.workflows_dir,
    settings.roles_dir,
    settings.sessions_dir,
]
```

This creates only 4 directories. Compare with `src/calm/install/templates.py`
`create_directory_structure()` (lines 230-237), which creates all 6:

```python
directories = [
    calm_home,
    calm_home / "workflows",
    calm_home / "roles",
    calm_home / "skills",
    calm_home / "sessions",
    calm_home / "journal",
]
```

## Differential Diagnosis

### Hypothesis A (confirmed): `init_cmd.py` was never updated when skills/journal were added

**Evidence:**
- `git log -- src/calm/cli/init_cmd.py` shows only one commit: `a47f945`
  (SPEC-058-01, the initial foundation package).
- `git log -- src/calm/config.py` shows `skills_dir` was added in `b26db69`
  (SPEC-058-05: Skills and Hooks) and `journal_dir` in `ec9fc27`
  (SPEC-058-02: Memory/GHAP).
- Both properties were added after `init_cmd.py` was written, and `init_cmd.py`
  was never updated to include them.

### Hypothesis B (eliminated): Directories are intentionally lazily created

**Evidence against:**
- `skills_dir` has NO lazy `mkdir` anywhere. `skill_loader.py` reads from
  `settings.skills_dir` directly (lines 137, 187) with no directory creation.
  If the directory is missing, skill loading will silently find nothing.
- While `journal_dir` does have defensive `mkdir` calls in `app.py:686` and
  `collector.py:52`, the full installer (`templates.py`) explicitly creates both
  directories up front, confirming they are part of the expected init structure.
- Lazy creation is a defensive fallback, not the intended initialization path.

## Root Cause

`init_cmd.py` was written in the initial foundation commit (SPEC-058-01) with
only 4 directories. When `skills_dir` and `journal_dir` properties were added
to `CalmSettings` in later commits (SPEC-058-02 and SPEC-058-05), `init_cmd.py`
was not updated to include them. The full installer in `templates.py` was written
later and correctly includes all 6 directories.

## Fix Plan

Add the two missing directories to init_cmd.py and update its test.

### 1. Update `src/calm/cli/init_cmd.py`

Add `settings.skills_dir` and `settings.journal_dir` to the directories list
(lines 28-33):

```python
directories = [
    home,
    settings.workflows_dir,
    settings.roles_dir,
    settings.sessions_dir,
    settings.skills_dir,
    settings.journal_dir,
]
```

Also update the docstring (lines 17-21) to include the two missing directories:
```
- ~/.calm/skills/ (skill templates)
- ~/.calm/journal/ (GHAP journal files)
```

### 2. Update `tests/calm/test_cli_init.py`

In `test_creates_directory_structure`, add assertions for the two new
directories (after line 48):

```python
assert (calm_home / "skills").exists()
assert (calm_home / "journal").exists()
```

### 3. Verification

After the fix:
- Run `pytest tests/calm/test_cli_init.py -v` to confirm all tests pass.
- Manually verify: remove `~/.calm/`, run `calm init`, confirm `skills/` and
  `journal/` exist with `ls ~/.calm/`.

### Regression Test Requirements

The existing `test_creates_directory_structure` test should be extended (as in
step 2 above) to assert `skills/` and `journal/` directories are created. This
test will fail if someone removes these directories from the init list in the
future.

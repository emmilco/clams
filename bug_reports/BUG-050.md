# BUG-050: SessionStart hook output not injected into context

## Reported

- **First noticed on commit**: 041c29b (Merge task SPEC-010)
- **Reported by**: orchestrator
- **Reported at**: 2025-12-13
- **Severity**: medium

## Reproduction Steps

1. Start a new Claude Code session in the clams repository
2. Observe the system reminders in context
3. Run the hook manually to see what it outputs:
   ```bash
   ./clams/hooks/session_start.sh
   ```

**Expected**: The GHAP Learning System instructions should appear in Claude's context at session start:
```
## GHAP Learning System

When you encounter tasks involving **debugging**, **investigation**, or **complex problem-solving**, use GHAP to track your reasoning:

1. **Start**: `mcp__clams__start_ghap` - State your goal, hypothesis, action, and prediction
2. **Update**: `mcp__clams__update_ghap` - Revise if your hypothesis changes
3. **Resolve**: `mcp__clams__resolve_ghap` - Record outcome (confirmed/falsified/abandoned)
...
```

**Actual**: Only a success message appears in context:
```
<system-reminder>
SessionStart:startup hook success: Success
</system-reminder>
```

The hook's JSON output with `"content"` field is not being processed/injected.

---

## Investigation (filled by Bug Investigator)

### Reproduction Confirmed

- [ ] Steps reproduced bug

**Observations during reproduction**:

Hook produces valid JSON output when run manually:
```bash
$ ./clams/hooks/session_start.sh
{
  "type": "light",
  "content": "## GHAP Learning System\n\nWhen you encounter tasks involving **debugging**..."
}
```

But Claude's context only shows:
```
SessionStart:startup hook success: Success
```

### Initial Hypothesis

[What do you believe is causing this bug? Be specific: file, function, line.]

### Differential Diagnosis

| # | Hypothesis | If True, Would See | If False, Would See | Evidence | Status |
|---|------------|-------------------|---------------------|----------|--------|
| 1 | Claude Code expects different output format | Documentation shows different schema | Our format matches docs | Need to check Claude Code hook docs | Pending |
| 2 | SessionStart hooks don't support content injection | Docs say SessionStart is signal-only | Docs show content injection for SessionStart | Need to check Claude Code hook docs | Pending |
| 3 | The `"content"` field needs different name/structure | Changing field name works | Field name is correct per docs | Need to check Claude Code hook docs | Pending |

### Evidentiary Scaffold

**Logging/assertions added**:
```bash
# N/A - need to check Claude Code documentation first
```

**Test command**:
```bash
./clams/hooks/session_start.sh
```

**Captured output**:
```json
{
  "type": "light",
  "content": "## GHAP Learning System\n\nWhen you encounter tasks involving **debugging**, **investigation**, or **complex problem-solving**, use GHAP to track your reasoning:\n\n1. **Start**: `mcp__clams__start_ghap` - State your goal, hypothesis, action, and prediction\n2. **Update**: `mcp__clams__update_ghap` - Revise if your hypothesis changes\n3. **Resolve**: `mcp__clams__resolve_ghap` - Record outcome (confirmed/falsified/abandoned)\n\nGHAP entries are embedded and clustered to surface relevant past experiences in future sessions.\n\n**When to use GHAP:**\n- Debugging a failing test or error\n- Investigating unexpected behavior\n- Exploring unfamiliar code\n- Any task where you form a hypothesis about root cause\n\n---\n"
}
```

### Root Cause (Proven)

**The bug is caused by**: [To be determined - need to investigate Claude Code hook documentation]

**Evidence**: [Pending investigation]

**Why alternatives were eliminated**:
- [Pending investigation]

---

## Fix Plan

### Code Changes

1. **File**: `clams/hooks/session_start.sh`
   **Function**: `main`
   **Change**: [To be determined based on investigation]
   **Rationale**: [To be determined]

### Regression Test

**Test file**: `tests/hooks/test_bug_050_regression.py`

**Test should**:
1. Run session_start.sh and capture output
2. Verify output matches expected schema for Claude Code hooks
3. Fail if output format is incorrect

**Test outline**:
```python
def test_bug_050_regression():
    # Setup: run session_start.sh
    # ...

    # Action: parse output as JSON
    # ...

    # Assert: verify correct schema (would have failed before fix)
    assert output_matches_claude_code_schema
```

### Verification

After implementing the fix:
```bash
# Run specific test
pytest tests/hooks/test_bug_050_regression.py -xvs

# Verify in live session
# Start new Claude Code session and check for GHAP instructions in context
```

---

## Implementation (filled by Implementer)

- **Implemented by**: [worker ID]
- **Commit**: [SHA]
- **Regression test file**: [path]

### Changes Made

[Brief summary of actual changes vs plan]

---

## Review (filled by Reviewers)

| Review # | Reviewer | Result | Date |
|----------|----------|--------|------|
| 1 | [worker ID] | [approved/changes_requested] | [date] |
| 2 | [worker ID] | [approved/changes_requested] | [date] |

---

## Resolution

- **Fixed in commit**: [SHA on main]
- **Verified by**: [worker ID]
- **Closed at**: [timestamp]

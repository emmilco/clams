# Bug Report: BUG-089

## Title
Shell breaks after worktree merge deletes current working directory

## First Noticed On Commit
9147724 (SPEC-061-03 merge)

## Reproduction Steps
1. `cd /path/to/.worktrees/SOME-TASK`
2. `calm worktree merge SOME-TASK`
3. All subsequent shell commands fail with exit code 1

## Expected Behavior
The merge command should refuse to proceed if the shell's CWD is inside the
target worktree, since deleting the CWD leaves the shell unrecoverable.

## Actual Behavior
The merge completes, deletes the worktree directory, and the shell's CWD
becomes invalid. Every subsequent command (including `cd /`) fails with
exit code 1. Only a session restart fixes it.

## Root Cause
`merge_worktree()` calls `os.chdir(main_repo)` before deletion, but this only
affects the **Python subprocess** — not the parent Bash shell. Claude Code's
Bash tool persists CWD between invocations, so once the directory is deleted
the shell is permanently broken.

`_warn_if_cwd_inside_worktree()` in the CLI warned but still proceeded with
the merge, so the warning was too late to prevent damage.

**Alternatives eliminated:**
- `os.chdir()` in the subprocess cannot propagate to the parent shell (Unix process model)
- Printing `cd` instructions after the merge is too late — the shell is already broken

## Fix Plan
1. Rename `_warn_if_cwd_inside_worktree` → `_refuse_if_cwd_inside_worktree`
2. Raise `click.ClickException` (exit 1 with clean message) instead of printing a warning
3. The error message tells the user to `cd` to the main repo and retry
4. Keep the defensive `os.chdir()` in `merge_worktree()` and `remove_worktree()` as belt-and-suspenders for programmatic callers
5. Regression test: verify merge fails cleanly when CWD is inside the worktree

============================= test session starts ==============================
platform darwin -- Python 3.13.6, pytest-8.4.2, pluggy-1.6.0 -- /Users/elliotmilco/.pyenv/versions/3.13.6/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/elliotmilco/Documents/GitHub/clams/.worktrees/SPEC-002-19
configfile: pyproject.toml
plugins: asyncio-1.2.0, xdist-3.8.0, timeout-2.4.0, anyio-4.10.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 16 items

tests/hooks/test_mcp_client.py::TestMCPClient::test_init PASSED
tests/hooks/test_mcp_client.py::TestMCPClient::test_connect_success 2025-12-04 12:56:35 [warning  ] mcp_client.connect_failed      error="'coroutine' object has no attribute '__aenter__'"
FAILED

=================================== FAILURES ===================================
______________________ TestMCPClient.test_connect_success ______________________

self = <tests.hooks.test_mcp_client.TestMCPClient object at 0x10bc5c910>

    @pytest.mark.asyncio
    async def test_connect_success(self) -> None:
        """Test successful connection to MCP server."""
        client = MCPClient(["mock-server"], timeout=5.0)
    
        # Mock stdio_client and session
        mock_read = AsyncMock()
        mock_write = AsyncMock()
        mock_session = AsyncMock(spec=ClientSession)
    
        with patch("mcp_client.stdio_client") as mock_stdio:
            with patch("mcp_client.ClientSession") as mock_session_cls:
                # stdio_client is a coroutine that returns a tuple
                async def mock_stdio_func(*args: Any) -> tuple[Any, Any]:
                    return (mock_read, mock_write)
    
                mock_stdio.side_effect = mock_stdio_func
                mock_session_cls.return_value = mock_session
    
                result = await client.connect()
    
>               assert result is True
E               assert False is True

tests/hooks/test_mcp_client.py:55: AssertionError
=============================== warnings summary ===============================
tests/hooks/test_mcp_client.py::TestMCPClient::test_connect_success
  /Users/elliotmilco/Documents/GitHub/clams/.worktrees/SPEC-002-19/tests/hooks/test_mcp_client.py:53: RuntimeWarning: coroutine 'TestMCPClient.test_connect_success.<locals>.mock_stdio_func' was never awaited
    result = await client.connect()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/hooks/test_mcp_client.py::TestMCPClient::test_connect_success - ...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
==================== 1 failed, 1 passed, 1 warning in 0.19s ====================
